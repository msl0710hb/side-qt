name: Qt macOS Build
on: [push, pull_request]

jobs:
  build-macos:
    runs-on: macos-14
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install Qt  # 修复 host 参数 + 保留你原有配置
        uses: jurplel/install-qt-action@v3
        with:
          version: '6.9.2'
          host: 'mac'  # 关键修复：macos → mac
          target: 'desktop'
          arch: 'clang_64'
          install-deps: true
          cache: true
          examples: false  # 保留你添加的参数

      - name: Configure Xcode
        run: |
          sudo xcode-select -switch /Applications/Xcode_16.4.app/Contents/Developer
          xcodebuild -version

      - name: CMake Configure
        run: |
          mkdir -p build/day0-build && cd build/day0-build
          cmake \
            -DCMAKE_BUILD_TYPE=Release \
            -DCMAKE_PREFIX_PATH="$Qt6_DIR" \
            -DCMAKE_OSX_ARCHITECTURES="x86_64;arm64" \
            -DCMAKE_OSX_DEPLOYMENT_TARGET=12.0 \
            ../../

      - name: Build
        run: |
          cd build/day0-build
          make -j$(sysctl -n hw.ncpu)